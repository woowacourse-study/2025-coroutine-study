# Chapter 4. 코루틴 빌더와 Job

## 코루틴 순차 처리

### join을 사용한 코루틴 순차 처리

- Job 객체의 join 함수를 사용하면 코루틴 간에 순차 처리가 가능함
- join 함수를 호출하면 join의 대상이 된 코루틴의 작업이 완료될 때까지 join을 호출한 코루틴이 일시 중단됨
- join 함수는 일시 중단이 가능한 지점에서만 호출될 수 있음

### joinAll을 사용한 코루틴 순차 처리

- joinAll 함수를 사용하면 복수의 코루틴에 대한 순차 처리가 가능함
- joinAll의 대상이 된 코루틴들의 실행이 모두 끝날 때까지 호출부의 코루틴을 일시 중단함
- 서로 독립적인 여러 코루틴을 병렬로 실행한 후 요청들이 모두 끝날 때까지 기다렸다가 다음 작업을 진행하는 것이 효율적임

<br>

## 코루틴 취소

> 코루틴이 실행될 필요가 없어졌음에도 취소하지 않고 계속 실행되도록 두면 코루틴은 계속해서 스레드를 사용하며,  
> 이는 애플리케이션의 성능 저하로 이어진다.

### cancel을 사용한 Job 취소

- 취소를 원하는 시점에 job.cancel()을 호출
- cancel 함수를 사용하면 cancel의 대상이 된 Job 객체는 곧바로 취소되는 것이 아니라 미래의 어느 시점에 취소됨

### cancelAndJoin을 사용한 순차 처리

- 취소에 대한 순차성을 보장함
- 코루틴이 취소 완료된 후에 실행되는 것을 보장할 수 있음

<br>

## 코루틴 취소 확인

> 코루틴이 취소를 확인하는 시점은 일반적으로 일시 중단 지점이나 코루틴이 실행을 대기하는 시점이며,  
> 이 시점들이 없다면 코루틴은 취소되지 않는다.

### delay를 사용한 취소 확인

- delay 함수는 일시 중단 함수(suspend fun)로 선언돼 특정 시간만큼 호출부의 코루틴을 일시 중단하게 함

### yield를 사용한 취소 확인

- yield 함수가 호출되면 코루틴은 자신이 사용하던 스레드를 양보함

### CoroutineScope.isActive를 사용한 취소 확인

- isActive: 코루틴이 활성화됐는지 확인할 수 있는 Boolean 타입의 프로퍼티
- 코루틴 내부의 작업이 일시 중단 지점 없이 계속된다면 명시적으로 코루틴이 취소됐는지 확인하는 코드를 넣어줌으로써 코드를 취소할 수 있도록 만들어야 함 → 그렇지 않으면 코루틴 취소가 동작하지 않음

<br>

## 코루틴의 상태

![IMG_0571](https://github.com/user-attachments/assets/62624429-f9af-4f40-97c1-54ac76f45996)


### 생성

- 코루틴 빌더를 통해 코루틴을 생성하면 코루틴은 기본적으로 생성 상태에 놓이며, 자동으로 실행 중 상태로 넘어감

### 실행 중

- 지연 코루틴이 아닌 코루틴을 만들면 자동으로 실행 중 상태로 바뀜
- 실행된 후에 일시 중단된 때도 실행 중 상태

### 실행 완료

- 코루틴의 모든 코드가 실행 완료된 경우 실행 완료 상태로 넘어감

### 취소 중

- 코루틴에 취소가 요청됐을 경우 취소 중 상태로 넘어가며, 이는 아직 취소된 상태가 아니어서 코루틴은 계속 실행됨

### 취소 완료

- 코루틴의 취소 확인 시점에 취소가 확인된 경우 취소 완료 상태가 됨

<br>

## Job의 상태 변수

> Job 객체는 코루틴을 추상화한 객체이므로 노출하는 상태 변수들은 코루틴의 상태를 간접적으로만 나타낸다.

### isActive

- 코루틴이 활성화되어 있는지의 여부
- 취소가 요청되거나 실행이 완료된 코루틴은 활성화되지 않음

### isCancelled

- 코루틴이 취소 요청되었는지의 여부

### isCompleted

- 코루틴 실행이 완료되었는지의 여부

![IMG_0572](https://github.com/user-attachments/assets/9df8261c-ea46-46e4-99cc-f6b47d270eec)
