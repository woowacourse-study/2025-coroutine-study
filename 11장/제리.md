# 코루틴 심화

## 공유상태를 사용하는 코루틴의 문제와 데이터 동기화

### 가변변수를 사용할 때의 문제점

- 코루틴에서 가변 변수를 사용할 때에는 멀티스레드 환경에서 실행되기 때문에 복수의 코루틴이 가변 변수를 공유한다.

### 발생이유1
- 메모리 가시성  

<img src="https://github.com/user-attachments/assets/59b3f185-3129-444e-aa3e-10c4afc0d345" width="300">  

CPU 캐시 메모리의 데이터가 메인 메모리로 전파되지 않은 상태에서    
다른 CPU에서 실행되는 스레드에서 count변수의 값을 읽게 된다면   

<img src="https://github.com/user-attachments/assets/a8233abc-1de6-48bb-81b4-ad3c707e4be3" width="300">  

위와 같이 CPU 캐시 메모리의 값이 메인 메모리로 플러시가 일어나면서  
연산은 두번 일어나지만 값은 하나만 증가하게 된다.  
